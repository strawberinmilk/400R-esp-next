(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{594:(e,t,a)=>{Promise.resolve().then(a.bind(a,9256))},2425:()=>{},7283:e=>{e.exports={firstViewWrapper:"firstView_firstViewWrapper__nAfjo",firstViewButton:"firstView_firstViewButton__8_Vpl"}},7448:(e,t,a)=>{"use strict";a.d(t,{GlobalSnackbarProvider:()=>n,W:()=>i});var s=a(5155),r=a(2115);a(2425);var o=a(5726);let l=(0,r.createContext)(void 0),i=()=>{let e=(0,r.useContext)(l);if(!e)throw Error("useGlobalSnackbar must be used within GlobalSnackbarProvider");return e},n=e=>{let{children:t}=e,[a,i]=(0,r.useState)("");r.useEffect(()=>{i(getComputedStyle(document.documentElement).getPropertyValue("--primary-color").trim()||"")},[]);let[n,d]=(0,r.useState)(!1),[u,c]=(0,r.useState)(""),[m,h]=(0,r.useState)(a);return(0,s.jsxs)(l.Provider,{value:{showSnackbar:(e,t)=>{c(e),h(t||a),d(!0)}},children:[t,(0,s.jsx)(o.A,{open:n,autoHideDuration:3e3,onClose:()=>d(!1),message:(0,s.jsx)("span",{style:{color:m},children:u}),anchorOrigin:{vertical:"bottom",horizontal:"center"}})]})}},8334:e=>{e.exports={pageWrapper:"page_pageWrapper__dwooz",mainCenter:"page_mainCenter__4_Gvp",footerFixed:"page_footerFixed__D_fRG"}},8725:e=>{e.exports={footLightMode:"FootLightMode_footLightMode__WVPva",formControl:"FootLightMode_formControl__cJVyl"}},9256:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>F});var s=a(5155),r=a(8334),o=a.n(r),l=a(2115);let i="7eda57ff-6226-4f8c-ba8f-02f632e88609",n=e=>{if(!e||"object"!=typeof e)return!1;let t=e.footLight,a=e.preset,s=e.constants,r=null==s?void 0:s.footLight,o=null==s?void 0:s.preset;return"string"==typeof e.type&&void 0!==t&&"number"==typeof t.volume&&"number"==typeof t.mode&&"boolean"==typeof t.isLighting&&void 0!==a&&"string"==typeof a.current&&"boolean"==typeof a.isMatched&&void 0!==r&&Array.isArray(r.modeVal)&&Array.isArray(r.modeName)&&void 0!==o&&Array.isArray(o.presetNameList)&&Array.isArray(o.presetValueList)};class d{constructor(e,t){this.exitCode=e,this.message=t}}let u=e=>e instanceof d||!!e&&"object"==typeof e&&"number"==typeof e.exitCode&&"string"==typeof e.message,c=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],[t,a]=(0,l.useState)(!1),[s,r]=(0,l.useState)(null),[o,d]=(0,l.useState)(null),u=(0,l.useRef)(null),c=(0,l.useRef)(null);(0,l.useEffect)(()=>{e&&(async()=>{let e=await h({mode:"getStatus"});e&&n(e)&&d(e)})()},[e]);let m=async()=>{if(!u.current||!c.current){let e=await navigator.bluetooth.requestDevice({filters:[{name:"400R-controller"}],optionalServices:[i]});if(u.current=e,!e.gatt)throw Error("Bluetooth GATT is not available on this device.");let t=await e.gatt.connect(),a=await t.getPrimaryService(i);c.current=await a.getCharacteristic("b661a0f3-a25c-47fa-96a2-17abcb9655df")}return c.current},h=async e=>{a(!0),r(null);try{let t=await m(),a=JSON.stringify(e),s=new TextEncoder;await t.writeValue(s.encode(a));let r=await t.readValue(),o=new TextDecoder;return JSON.parse(o.decode(r.buffer))}catch(e){return e&&"object"==typeof e&&"message"in e?r(e.message||"送信失敗"):r("送信失敗"),null}finally{a(!1)}};return{isConnecting:t,error:s,sendBLEData:h,status:o,setStatus:d}};var m=a(9718),h=a.n(m),g=a(2330),f=a(7448);a(2425);let p=()=>{let{showSnackbar:e}=(0,f.W)(),t=e=>getComputedStyle(document.documentElement).getPropertyValue(e).trim()||"";return{showSnackBarWithExitCode:a=>{let{exitCode:s,message:r}=a,o=t("--primary-color"),l=t("--error-color");e(r,0===s?o:l)}}},x=e=>{let{bluetoothHook:t}=e,{showSnackBarWithExitCode:a}=p(),{error:r,sendBLEData:o}=t,[i,n]=(0,l.useState)(255);(0,l.useEffect)(()=>{t.status&&t.status.footLight&&n(t.status.footLight.volume)},[t.status]);let d=async e=>{let t=await o({mode:"footLightVol",value:e});t&&u(t)&&a({exitCode:t.exitCode,message:t.message})};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:h().footLightVolume,children:[(0,s.jsxs)("label",{htmlFor:"footLightVolume",children:["フットライト明度: ",i]}),(0,s.jsx)("div",{className:h().sliderRow,children:(0,s.jsx)(g.Ay,{id:"footLightVolume",value:i,min:0,max:255,step:1,onChange:(e,t)=>n(t),onChangeCommitted:(e,t)=>d(t),style:{width:200}})})]}),r&&(0,s.jsx)("div",{className:h().error,children:r})]})};var v=a(8725),y=a.n(v),b=a(6673),j=a(8994),_=a(7348),w=a(9816);let L=e=>{let{bluetoothHook:t}=e,{showSnackBarWithExitCode:a}=p(),{isConnecting:r,sendBLEData:o}=t,[i,n]=(0,l.useState)(0);(0,l.useEffect)(()=>{t.status&&t.status.footLight&&n(t.status.footLight.mode)},[t.status]);let d=l.useMemo(()=>{var e,a;let s=null==(a=t.status)||null==(e=a.constants)?void 0:e.footLight;return s&&s.modeVal&&s.modeName?s.modeVal.map((e,t)=>{var a;return{id:e,name:null!=(a=s.modeName[t])?a:String(e)}}):[]},[t.status]),c=async e=>{let t=await o({mode:"footLightMode",value:e});t&&u(t)&&a({exitCode:t.exitCode,message:t.message})};return(0,s.jsx)("div",{className:y().footLightMode,children:(0,s.jsxs)(w.A,{size:"small",className:y().formControl,children:[(0,s.jsx)(_.A,{id:"footLightMode-label",children:"フットライトモード"}),(0,s.jsx)(j.A,{labelId:"footLightMode-label",id:"footLightMode",value:i,label:"フットライトモード",onChange:async e=>{let t=Number(e.target.value);n(t),await c(t)},disabled:r||0===d.length,children:d.map(e=>(0,s.jsx)(b.A,{value:e.id,children:e.name},e.id))})]})})};var C=a(8468);let S=e=>{let{bluetoothHook:t}=e,{showSnackbar:a}=(0,f.W)(),{isConnecting:r,sendBLEData:o,setStatus:l}=t,i=async()=>{let e=await o({mode:"getStatus"});e&&n(e)&&(l(e),a(JSON.stringify(e),"#FFF"))};return(0,s.jsx)(C.A,{variant:"contained",color:"primary",onClick:i,disabled:r,sx:{mt:2},children:"ステータス取得"})};function A(e){var t;let{bluetoothHook:a}=e,r=a.status,[o,i]=(0,l.useState)(""),[d,u]=(0,l.useState)(!1),[c,m]=(0,l.useState)("");if(!r||!(null==(t=r.constants)?void 0:t.preset))return null;let h=r.constants.preset.presetNameList,g=r.preset.current,f=r.preset.isMatched,p=async e=>{let t=e.target.value;i(t),await a.sendBLEData({mode:"presetLoad",presetName:t}),setTimeout(()=>{a.sendBLEData({mode:"getStatus"}).then(e=>{e&&n(e)&&a.setStatus(e)})},500)},x=async()=>{c&&(await a.sendBLEData({mode:"presetSave",presetName:c}),u(!1),setTimeout(()=>{a.sendBLEData({mode:"getStatus"}).then(e=>{e&&n(e)&&a.setStatus(e)})},500))};return(0,s.jsxs)("div",{style:{marginBottom:24},children:[(0,s.jsxs)("div",{style:{marginBottom:8},children:["プリセット状態: ",f?g:"カスタム状態"]}),(0,s.jsxs)(w.A,{size:"small",style:{minWidth:180,marginRight:16},children:[(0,s.jsx)(_.A,{id:"preset-select-label",children:"プリセット選択"}),(0,s.jsx)(j.A,{labelId:"preset-select-label",value:o,label:"プリセット選択",onChange:p,children:h.map(e=>(0,s.jsx)(b.A,{value:e,children:e},e))})]}),(0,s.jsx)(C.A,{variant:"outlined",size:"small",onClick:()=>{u(!0),m("")},sx:{ml:1},children:"プリセットとして保存"}),d&&(0,s.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",gap:8,marginLeft:16},children:[(0,s.jsxs)(w.A,{size:"small",style:{minWidth:140},children:[(0,s.jsx)(_.A,{id:"preset-save-select-label",children:"保存先プリセット"}),(0,s.jsx)(j.A,{labelId:"preset-save-select-label",value:c,label:"保存先プリセット",onChange:e=>{m(e.target.value)},children:h.map(e=>(0,s.jsx)(b.A,{value:e,children:e},e))})]}),(0,s.jsx)(C.A,{variant:"contained",size:"small",onClick:x,disabled:!c,children:"保存"}),(0,s.jsx)(C.A,{variant:"text",size:"small",onClick:()=>{u(!1),m("")},children:"キャンセル"})]})]})}let V=e=>{let{bluetoothHook:t}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x,{bluetoothHook:t}),(0,s.jsx)(L,{bluetoothHook:t}),(0,s.jsx)(A,{bluetoothHook:t}),(0,s.jsx)("br",{}),(0,s.jsx)(S,{bluetoothHook:t})]})};var N=a(4426),k=a(7283),E=a.n(k);let B=e=>{let{setIsConnected:t,bluetoothHook:a}=e,r=async()=>{await a.sendBLEData({mode:"getStatus"})&&t(!0)};return(0,s.jsxs)("div",{className:E().firstViewWrapper,children:[(0,s.jsx)(C.A,{className:E().firstViewButton,variant:"contained",color:"primary",onClick:r,sx:{mb:4},disabled:a.isConnecting,startIcon:a.isConnecting?(0,s.jsx)(N.A,{size:20,color:"inherit"}):void 0,children:a.isConnecting?"接続中...":"BLE接続"}),a.error&&(0,s.jsx)("div",{style:{color:"red"},children:a.error})]})};function F(){let[e,t]=(0,l.useState)(!1),a=c(e);return(0,s.jsx)("div",{className:o().pageWrapper,children:(0,s.jsx)("main",{className:o().mainCenter,children:e?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(V,{bluetoothHook:a})}):(0,s.jsx)(B,{setIsConnected:t,bluetoothHook:a})})})}},9718:e=>{e.exports={footLightVolume:"FootLightVolume_footLightVolume__xVs7L",sliderRow:"FootLightVolume_sliderRow__zqYBX",error:"FootLightVolume_error__TOize"}}},e=>{e.O(0,[922,726,646,441,964,358],()=>e(e.s=594)),_N_E=e.O()}]);